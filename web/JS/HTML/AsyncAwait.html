<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async/Await</title>
    <style>
        /* CSS is embedded here for easy single-file usage */
        :root {
            --primary-color: #007bff;
            /* Sequential */
            --parallel-color: #28a745;
            /* Parallel */
            --race-color: #ffc107;
            /* Race */
            --cancel-color: #dc3545;
            /* Cancel */
            --bg-light: #f8f9fa;
            --card-bg: #ffffff;
            --info-color: #17a2b8;
            --progress-bg: #e9ecef;
        }

        body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            background-color: var(--bg-light);
            color: #333;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        h1 {
            color: var(--primary-color);
        }

        /* Tabbed Interface */
        .tab-menu {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Action Buttons Grouping */
        .action-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }

        .action-group button {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        /* Run Button Specific Styling and Visibility */
        #runSequentialButton {
            background-color: var(--primary-color);
        }

        #runParallelButton {
            background-color: var(--parallel-color);
        }

        #runRaceButton {
            background-color: var(--race-color);
        }

        #cancelButton {
            background-color: var(--cancel-color);
        }

        .run-buttons button {
            display: none;
        }

        /* Hide all run buttons by default */
        .run-buttons.sequential-active #runSequentialButton {
            display: block;
        }

        .run-buttons.parallel-active #runParallelButton {
            display: block;
        }

        .run-buttons.race-active #runRaceButton {
            display: block;
        }

        /* Progress Bar */
        #progressBarContainer {
            height: 8px;
            background: var(--progress-bg);
            border-radius: 4px;
            margin-bottom: 15px;
        }

        #progressBar {
            width: 0%;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Dynamic Loading Status */
        #loadingIndicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: var(--progress-bg);
            border-radius: 6px;
            color: #495057;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Data Card and Info Paragraph Styling */
        .data-card {
            background-color: var(--card-bg);
            border: 1px solid #e0e0e0;
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .data-card h3 {
            margin-top: 0;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-card pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            max-height: 100px;
            overflow: auto;
        }

        .data-card.parallel-style {
            border-left-color: var(--parallel-color);
        }

        .data-card.race-style {
            border-left-color: var(--race-color);
        }

        .data-card.error-style {
            border-left-color: var(--cancel-color);
        }

        #infoParagraph {
            margin-bottom: 20px;
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            background-color: #f0f8ff;
        }

        #infoParagraph .highlight {
            font-weight: bold;
            color: var(--primary-color);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>âœ¨ Async/Await</h1>
        <p>Explore Sequential, Parallel (`Promise.all`), and Race (`Promise.race`) modes.</p>

        <div class="tab-menu" id="tabMenu">
            <button class="tab-button active" data-mode="sequential">Sequential</button>
            <button class="tab-button" data-mode="parallel">Parallel (`Promise.all`)</button>
            <button class="tab-button" data-mode="race">Race (`Promise.race`)</button>
        </div>

        <p id="infoParagraph"></p>

        <div class="action-group">
            <div class="run-buttons sequential-active" id="runButtonsContainer">
                <button id="runSequentialButton">Run Sequential Demo</button>
                <button id="runParallelButton">Run Parallel Demo</button>
                <button id="runRaceButton">Run Race Demo</button>
            </div>

            <button id="cancelButton" class="hidden">Cancel Operation</button>
        </div>

        <div id="progressBarContainer" class="hidden">
            <div id="progressBar"></div>
        </div>

        <div id="loadingIndicator" class="hidden"></div>

        <div id="outputContainer">
            <p style="text-align:center; color:#6c757d;">Select a mode above and click Run to start.</p>
        </div>

        <div id="errorMessage" class="hidden data-card error-style">
            <h3>Error Log</h3>
            <pre id="errorLog"></pre>
        </div>
    </div>

    <script>
        const outputContainer = document.getElementById('outputContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const errorLog = document.getElementById('errorLog');

        const runSequentialButton = document.getElementById('runSequentialButton');
        const runParallelButton = document.getElementById('runParallelButton');
        const runRaceButton = document.getElementById('runRaceButton');
        const runButtonsContainer = document.getElementById('runButtonsContainer');

        const cancelButton = document.getElementById('cancelButton');
        const tabMenu = document.getElementById('tabMenu');
        const progressBar = document.getElementById('progressBar');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const infoParagraph = document.getElementById('infoParagraph');

        let state = {
            currentMode: 'sequential',
            isLoading: false,
            controller: null
        };

        // --- Local Mock Data (8 datasets) ---
        const localData = {
            user: { id: 1, name: "Ayush Narware", role: "Developer", email: "ayush@example.com" },
            posts: [
                { id: 1, title: "Async JS", body: "Understanding async/await and promises." },
                { id: 2, title: "Frontend Mastery", body: "Learning React and Redux deeply." }
            ],
            comments: [
                { id: 1, name: "John", body: "Excellent explanation!" },
                { id: 2, name: "Maya", body: "Very helpful, thank you!" }
            ],
            todos: [
                { id: 1, task: "Complete Project", status: "Pending" },
                { id: 2, task: "Prepare Resume", status: "Completed" }
            ],
            products: [
                { id: 1, name: "Laptop", price: 55000 },
                { id: 2, name: "Smartphone", price: 25000 }
            ],
            weather: { city: "Indore", temperature: "27Â°C", condition: "Sunny" },
            events: [
                { id: 1, title: "Hackathon", date: "2025-11-10" },
                { id: 2, title: "Tech Talk", date: "2025-11-15" }
            ],
            stats: { visitorsToday: 245, activeUsers: 68, conversions: 12 }
        };

        // --- Local Data Fetch Simulation ---
        async function fetchDataLocal(type, delayMs = 1000, controller = null) {
            const start = performance.now();
            return new Promise((resolve, reject) => {
                const timeout = setTimeout(() => {
                    if (!localData[type]) return reject(new Error(`No data found for type: ${type}`));
                    const end = performance.now();
                    resolve({ data: localData[type], timeTaken: end - start });
                }, delayMs);

                if (controller) {
                    controller.signal.addEventListener("abort", () => {
                        clearTimeout(timeout);
                        reject(new Error("Operation cancelled by user."));
                    });
                }
            });
        }

        // --- UI Helpers ---
        function displayData(title, data, color, timeTaken = null, isParallel = false, isRace = false) {
            const card = document.createElement('div');
            card.className = 'data-card';
            if (isParallel) card.classList.add('parallel-style');
            if (isRace) card.classList.add('race-style');
            card.style.borderLeftColor = color;

            const timeInfo = timeTaken ? `<span class="time-info">Time: ${timeTaken.toFixed(2)} ms</span>` : '';
            card.innerHTML = `<h3>${title} ${timeInfo}</h3><pre>${JSON.stringify(data, null, 2).substring(0, 200)}...</pre>`;
            outputContainer.appendChild(card);
        }

        function logError(message) {
            errorMessage.classList.remove('hidden');
            errorLog.textContent = new Date().toLocaleTimeString() + " | " + message + "\n" + errorLog.textContent;
        }

        function setLoadingState(isLoading, message = '') {
            state.isLoading = isLoading;
            runSequentialButton.disabled = isLoading;
            runParallelButton.disabled = isLoading;
            runRaceButton.disabled = isLoading;
            cancelButton.classList.toggle('hidden', !isLoading);
            progressBarContainer.classList.toggle('hidden', !isLoading);

            if (isLoading) {
                outputContainer.innerHTML = '';
                loadingIndicator.classList.remove('hidden');
                loadingIndicator.innerHTML = `<div class="spinner"></div> ${message}`;
            } else {
                loadingIndicator.classList.add('hidden');
                progressBar.style.width = '0%';
            }
        }

        function updateProgressBar(percentage) {
            progressBar.style.width = `${percentage}%`;
            const modeColors = {
                sequential: 'var(--primary-color)',
                parallel: 'var(--parallel-color)',
                race: 'var(--race-color)'
            };
            progressBar.style.backgroundColor = modeColors[state.currentMode];
            const spinner = document.querySelector('.spinner');
            if (spinner) spinner.style.borderTopColor = modeColors[state.currentMode];
        }

        // --- SEQUENTIAL MODE ---
        async function runSequentialLoad() {
            const controller = new AbortController();
            state.controller = controller;
            setLoadingState(true, 'Sequentially Loading 8 Datasets...');
            const startTime = performance.now();

            try {
                const keys = Object.keys(localData);
                for (let i = 0; i < keys.length; i++) {
                    const result = await fetchDataLocal(keys[i], 700 + i * 100, controller);
                    updateProgressBar(((i + 1) / keys.length) * 100);
                    displayData(`${i + 1}. ${keys[i].toUpperCase()}`, result.data, 'var(--primary-color)', result.timeTaken);
                }
                const endTime = performance.now();
                displayData('âœ… Sequential Load Complete!',
                    { TotalTime: `${(endTime - startTime).toFixed(2)} ms` },
                    'var(--info-color)'
                );
            } catch (error) {
                logError(error.message);
            } finally {
                setLoadingState(false);
                state.controller = null;
            }
        }

        // --- PARALLEL MODE ---
        async function runParallelLoad() {
            const controller = new AbortController();
            state.controller = controller;
            setLoadingState(true, 'Running 8 Tasks in Parallel...');
            const startTime = performance.now();

            try {
                const promises = Object.keys(localData).map((key, i) => fetchDataLocal(key, 700 + i * 100, controller));
                const results = await Promise.all(promises);
                updateProgressBar(100);

                results.forEach((res, i) => {
                    displayData(`${i + 1}. ${Object.keys(localData)[i].toUpperCase()}`, res.data, 'var(--parallel-color)', res.timeTaken, true);
                });

                const endTime = performance.now();
                displayData('âœ… Parallel Load Complete!',
                    { TotalTime: `${(endTime - startTime).toFixed(2)} ms` },
                    'var(--info-color)'
                );
            } catch (error) {
                logError(error.message);
            } finally {
                setLoadingState(false);
                state.controller = null;
            }
        }

        // --- RACE MODE ---
        async function runRaceLoad() {
            setLoadingState(true, 'Finding the Fastest Dataset (Race Mode)...');
            const startTime = performance.now();

            try {
                const keys = Object.keys(localData);
                const tasks = keys.map((key, i) => fetchDataLocal(key, 500 + i * 200));
                const fastestResult = await Promise.race(tasks);
                updateProgressBar(100);

                displayData('ðŸ† Fastest Result', fastestResult.data, 'var(--race-color)', fastestResult.timeTaken, false, true);
                const endTime = performance.now();

                displayData('âœ… Race Load Complete!',
                    { TotalTime: `${(endTime - startTime).toFixed(2)} ms` },
                    'var(--info-color)'
                );
            } catch (error) {
                logError(error.message);
            } finally {
                setLoadingState(false);
            }
        }

        // --- Event Listeners ---
        runSequentialButton.addEventListener('click', runSequentialLoad);
        runParallelButton.addEventListener('click', runParallelLoad);
        runRaceButton.addEventListener('click', runRaceLoad);

        cancelButton.addEventListener('click', () => {
            if (state.controller) {
                state.controller.abort();
                logError("User cancelled operation!");
                setLoadingState(false);
            }
        });

        tabMenu.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-button') && !state.isLoading) {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                state.currentMode = e.target.dataset.mode;
                updateUIForMode();
            }
        });

        // --- UI Update ---
        function updateUIForMode() {
            const mode = state.currentMode;
            let paragraphText = '';
            let color = 'var(--primary-color)';

            switch (mode) {
                case 'sequential':
                    paragraphText = 'In <span class="highlight">Sequential Mode</span>, tasks run one after another.';
                    color = 'var(--primary-color)';
                    break;
                case 'parallel':
                    paragraphText = 'In <span class="highlight">Parallel Mode</span>, tasks run together using <b>Promise.all()</b>.';
                    color = 'var(--parallel-color)';
                    break;
                case 'race':
                    paragraphText = 'In <span class="highlight">Race Mode</span>, we use <b>Promise.race()</b> and get the fastest one.';
                    color = 'var(--race-color)';
                    break;
            }
            infoParagraph.innerHTML = paragraphText;
            infoParagraph.style.borderLeftColor = color;
            const highlight = infoParagraph.querySelector('.highlight');
            if (highlight) highlight.style.color = color;
        }

        document.addEventListener('DOMContentLoaded', updateUIForMode);
    </script>

    <script src="../AsyncAwait.js"></script>
</body>

</html>